import{sharedConfig as ye}from"solid-js";import{provideRequestEvent as be}from"solid-js/web/storage";import{toWebRequest as ze,getRequestIP as we,eventHandler as Se,getHeader as w,getRequestURL as _,readRawBody as Ee,readBody as Ie,setHeader as Re}from"h3";var Ae=(e=>(e[e.AggregateError=1]="AggregateError",e[e.ArrowFunction=2]="ArrowFunction",e[e.ErrorPrototypeStack=4]="ErrorPrototypeStack",e[e.ObjectAssign=8]="ObjectAssign",e[e.BigIntTypedArray=16]="BigIntTypedArray",e))(Ae||{});function d(e,t){if(!e)throw t}function xe(e){switch(e){case'"':return'\\"';case"\\":return"\\\\";case`
`:return"\\n";case"\r":return"\\r";case"\b":return"\\b";case"	":return"\\t";case"\f":return"\\f";case"<":return"\\x3C";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:return}}function h(e){let t="",r=0,i;for(let s=0,a=e.length;s<a;s++)i=xe(e[s]),i&&(t+=e.slice(r,s)+i,r=s+1);return r===0?t=e:t+=e.slice(r),t}function Pe(e){switch(e){case"\\\\":return"\\";case'\\"':return'"';case"\\n":return`
`;case"\\r":return"\r";case"\\b":return"\b";case"\\t":return"	";case"\\f":return"\f";case"\\x3C":return"<";case"\\u2028":return"\u2028";case"\\u2029":return"\u2029";default:return e}}function p(e){return e.replace(/(\\\\|\\"|\\n|\\r|\\b|\\t|\\f|\\u2028|\\u2029|\\x3C)/g,Pe)}var g="__SEROVAL_REFS__",E="$R",S=`self.${E}`;function ke(e){return e==null?`${S}=${S}||[]`:`(${S}=${S}||{})["${h(e)}"]=[]`}var X=new Map,v=new Map;function O(e){return X.has(e)}function Fe(e){return v.has(e)}function Ve(e){return d(O(e),new Error("Missing reference id")),X.get(e)}function Oe(e){return d(Fe(e),new Error("Missing reference for id:"+e)),v.get(e)}typeof globalThis<"u"?Object.defineProperty(globalThis,g,{value:v,configurable:!0,writable:!1,enumerable:!1}):typeof window<"u"?Object.defineProperty(window,g,{value:v,configurable:!0,writable:!1,enumerable:!1}):typeof self<"u"?Object.defineProperty(self,g,{value:v,configurable:!0,writable:!1,enumerable:!1}):typeof global<"u"&&Object.defineProperty(global,g,{value:v,configurable:!0,writable:!1,enumerable:!1});function Y(e,t){for(let r=0,i=t.length;r<i;r++){let s=t[r];e.has(s)||(e.add(s),s.extends&&Y(e,s.extends))}}function ee(e){if(e){let t=new Set;return Y(t,e),[...t]}}var{toString:je}=Object.prototype,W=class extends Error{constructor(t){super('Unsupported type "'+je.call(t)+'"'),this.value=t}},Ce={0:"Symbol.asyncIterator",1:"Symbol.hasInstance",2:"Symbol.isConcatSpreadable",3:"Symbol.iterator",4:"Symbol.match",5:"Symbol.matchAll",6:"Symbol.replace",7:"Symbol.search",8:"Symbol.species",9:"Symbol.split",10:"Symbol.toPrimitive",11:"Symbol.toStringTag",12:"Symbol.unscopables"},j={[Symbol.asyncIterator]:0,[Symbol.hasInstance]:1,[Symbol.isConcatSpreadable]:2,[Symbol.iterator]:3,[Symbol.match]:4,[Symbol.matchAll]:5,[Symbol.replace]:6,[Symbol.search]:7,[Symbol.species]:8,[Symbol.split]:9,[Symbol.toPrimitive]:10,[Symbol.toStringTag]:11,[Symbol.unscopables]:12},De={0:Symbol.asyncIterator,1:Symbol.hasInstance,2:Symbol.isConcatSpreadable,3:Symbol.iterator,4:Symbol.match,5:Symbol.matchAll,6:Symbol.replace,7:Symbol.search,8:Symbol.species,9:Symbol.split,10:Symbol.toPrimitive,11:Symbol.toStringTag,12:Symbol.unscopables},Me={2:"!0",3:"!1",1:"void 0",0:"null",4:"-0",5:"1/0",6:"-1/0",7:"0/0"},Te={2:!0,3:!1,1:void 0,0:null,4:-0,5:1/0,6:-1/0,7:NaN},te={0:"Error",1:"EvalError",2:"RangeError",3:"ReferenceError",4:"SyntaxError",5:"TypeError",6:"URIError"},$e={0:Error,1:EvalError,2:RangeError,3:ReferenceError,4:SyntaxError,5:TypeError,6:URIError};function f(e){return{t:2,i:void 0,s:e,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}var C=f(2),D=f(3),Ue=f(1),Be=f(0),_e=f(4),We=f(5),Ne=f(6),Le=f(7);function $(e){return e instanceof EvalError?1:e instanceof RangeError?2:e instanceof ReferenceError?3:e instanceof SyntaxError?4:e instanceof TypeError?5:e instanceof URIError?6:0}function qe(e){let t=te[$(e)];return e.name!==t?{name:e.name}:e.constructor.name!==t?{name:e.constructor.name}:{}}function N(e,t){let r=qe(e),i=Object.getOwnPropertyNames(e);for(let s=0,a=i.length,n;s<a;s++)n=i[s],n!=="name"&&n!=="message"&&(n==="stack"?t&4&&(r=r||{},r[n]=e[n]):(r=r||{},r[n]=e[n]));return r}function re(e){return Object.isFrozen(e)?3:Object.isSealed(e)?2:Object.isExtensible(e)?0:1}function Ke(e){switch(e){case 1/0:return We;case-1/0:return Ne}return e!==e?Le:Object.is(e,-0)?_e:{t:0,i:void 0,s:e,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function M(e){return{t:1,i:void 0,s:h(e),l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function He(e){return{t:3,i:void 0,s:""+e,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function Ze(e){return{t:4,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function Je(e,t){return{t:5,i:e,s:t.toISOString(),l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,f:void 0,a:void 0,b:void 0,o:void 0}}function Ge(e,t){return{t:6,i:e,s:void 0,l:void 0,c:h(t.source),m:t.flags,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function Qe(e,t){let r=new Uint8Array(t),i=r.length,s=new Array(i);for(let a=0;a<i;a++)s[a]=r[a];return{t:19,i:e,s,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function Xe(e,t){return d(t in j,new Error("Only well-known symbols are supported.")),{t:17,i:e,s:j[t],l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function L(e,t){return{t:18,i:e,s:h(Ve(t)),l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function ie(e,t,r){return{t:25,i:e,s:r,l:void 0,c:h(t),m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function Ye(e,t,r){return{t:9,i:e,s:void 0,l:t.length,c:void 0,m:void 0,p:void 0,e:void 0,a:r,f:void 0,b:void 0,o:re(t)}}function et(e,t){return{t:21,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:t,b:void 0,o:void 0}}function tt(e,t,r){return{t:15,i:e,s:void 0,l:t.length,c:t.constructor.name,m:void 0,p:void 0,e:void 0,a:void 0,f:r,b:t.byteOffset,o:void 0}}function rt(e,t,r){return{t:16,i:e,s:void 0,l:t.length,c:t.constructor.name,m:void 0,p:void 0,e:void 0,a:void 0,f:r,b:t.byteOffset,o:void 0}}function it(e,t,r){return{t:20,i:e,s:void 0,l:t.byteLength,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:r,b:t.byteOffset,o:void 0}}function st(e,t,r){return{t:13,i:e,s:$(t),l:void 0,c:void 0,m:h(t.message),p:r,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function at(e,t,r){return{t:14,i:e,s:$(t),l:void 0,c:void 0,m:h(t.message),p:r,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}function nt(e,t,r){return{t:7,i:e,s:void 0,l:t,c:void 0,m:void 0,p:void 0,e:void 0,a:r,f:void 0,b:void 0,o:void 0}}function se(e,t){return{t:28,i:void 0,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:[e,t],f:void 0,b:void 0,o:void 0}}function ae(e,t){return{t:30,i:void 0,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:[e,t],f:void 0,b:void 0,o:void 0}}function ne(e,t,r){return{t:31,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:r,f:t,b:void 0,o:void 0}}function ot(e,t){return{t:32,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:t,b:void 0,o:void 0}}function lt(e,t){return{t:33,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:t,b:void 0,o:void 0}}function ut(e,t){return{t:34,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:t,b:void 0,o:void 0}}function oe(e){let t=[],r=-1,i=-1,s=e[Symbol.iterator]();for(;;)try{let a=s.next();if(t.push(a.value),a.done){i=t.length-1;break}}catch(a){r=t.length,t.push(a)}return{v:t,t:r,d:i}}function ct(e){return()=>{let t=0;return{[Symbol.iterator](){return this},next(){if(t>e.d)return{done:!0,value:void 0};let r=t++,i=e.v[r];if(r===e.t)throw i;return{done:r===e.d,value:i}}}}}var dt={},ht={},ft={0:{},1:{},2:{},3:{},4:{}},pt=class{constructor(t){this.marked=new Set,this.plugins=t.plugins,this.features=31^(t.disabledFeatures||0),this.refs=t.refs||new Map}markRef(t){this.marked.add(t)}isMarked(t){return this.marked.has(t)}getIndexedValue(t){let r=this.refs.get(t);if(r!=null)return this.markRef(r),{type:1,value:Ze(r)};let i=this.refs.size;return this.refs.set(t,i),{type:0,value:i}}getReference(t){let r=this.getIndexedValue(t);return r.type===1?r:O(t)?{type:2,value:L(r.value,t)}:r}getStrictReference(t){d(O(t),new Error("Cannot serialize "+typeof t+" without reference ID."));let r=this.getIndexedValue(t);return r.type===1?r.value:L(r.value,t)}parseFunction(t){return this.getStrictReference(t)}parseWellKnownSymbol(t){let r=this.getReference(t);return r.type!==0?r.value:(d(t in j,new Error("Cannot serialized unsupported symbol.")),Xe(r.value,t))}parseSpecialReference(t){let r=this.getIndexedValue(ft[t]);return r.type===1?r.value:{t:26,i:r.value,s:t,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:void 0,b:void 0,o:void 0}}parseIteratorFactory(){let t=this.getIndexedValue(dt);return t.type===1?t.value:{t:27,i:t.value,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:this.parseWellKnownSymbol(Symbol.iterator),b:void 0,o:void 0}}parseAsyncIteratorFactory(){let t=this.getIndexedValue(ht);return t.type===1?t.value:{t:29,i:t.value,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:[this.parseSpecialReference(1),this.parseWellKnownSymbol(Symbol.asyncIterator)],f:void 0,b:void 0,o:void 0}}createObjectNode(t,r,i,s){return{t:i?11:10,i:t,s:void 0,l:void 0,c:void 0,m:void 0,p:s,e:void 0,a:void 0,f:void 0,b:void 0,o:re(r)}}createMapNode(t,r,i,s){return{t:8,i:t,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:{k:r,v:i,s},a:void 0,f:this.parseSpecialReference(0),b:void 0,o:void 0}}createPromiseConstructorNode(t){return{t:22,i:t,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:void 0,f:this.parseSpecialReference(1),b:void 0,o:void 0}}};function T(){let e,t;return{promise:new Promise((r,i)=>{e=r,t=i}),resolve(r){e(r)},reject(r){t(r)}}}function vt(e){return"__SEROVAL_STREAM__"in e}function z(){let e=new Set,t=[],r=!0,i=!1;function s(o){for(let l of e.keys())l.next(o)}function a(o){for(let l of e.keys())l.throw(o)}function n(o){for(let l of e.keys())l.return(o)}return{__SEROVAL_STREAM__:!0,on(o){r&&e.add(o);for(let l=0,u=t.length;l<u;l++){let c=t[l];l===u-1?i?o.return(c):o.throw(c):o.next(c)}return()=>{r&&e.delete(o)}},next(o){r&&(t.push(o),s(o))},throw(o){r&&(t.push(o),a(o),r=!1,i=!1,e.clear())},return(o){r&&(t.push(o),n(o),r=!1,i=!0,e.clear())}}}function gt(e){let t=z(),r=e[Symbol.asyncIterator]();async function i(){try{let s=await r.next();s.done?t.return(s.value):(t.next(s.value),await i())}catch(s){t.throw(s)}}return i().catch(()=>{}),t}function mt(e){return()=>{let t=[],r=[],i=0,s=-1,a=!1;function n(){for(let l=0,u=r.length;l<u;l++)r[l].resolve({done:!0,value:void 0})}e.on({next(l){let u=r.shift();u&&u.resolve({done:!1,value:l}),t.push(l)},throw(l){let u=r.shift();u&&u.reject(l),n(),s=t.length,t.push(l),a=!0},return(l){let u=r.shift();u&&u.resolve({done:!0,value:l}),n(),s=t.length,t.push(l)}});function o(){let l=i++,u=t[l];if(l!==s)return{done:!1,value:u};if(a)throw u;return{done:!0,value:u}}return{[Symbol.asyncIterator](){return this},async next(){if(s===-1){let l=i++;if(l>=t.length){let u=T();return r.push(u),await u.promise}return{done:!1,value:t[l]}}return i>s?{done:!0,value:void 0}:o()}}}}function yt(e){switch(e){case"Int8Array":return Int8Array;case"Int16Array":return Int16Array;case"Int32Array":return Int32Array;case"Uint8Array":return Uint8Array;case"Uint16Array":return Uint16Array;case"Uint32Array":return Uint32Array;case"Uint8ClampedArray":return Uint8ClampedArray;case"Float32Array":return Float32Array;case"Float64Array":return Float64Array;case"BigInt64Array":return BigInt64Array;case"BigUint64Array":return BigUint64Array;default:throw new Error(`Unknown TypedArray "${e}"`)}}function q(e,t){switch(t){case 3:return Object.freeze(e);case 1:return Object.preventExtensions(e);case 2:return Object.seal(e);default:return e}}var bt=class{constructor(t){this.plugins=t.plugins,this.refs=t.refs||new Map}deserializeReference(t){return this.assignIndexedValue(t.i,Oe(p(t.s)))}deserializeArray(t){let r=t.l,i=this.assignIndexedValue(t.i,new Array(r)),s;for(let a=0;a<r;a++)s=t.a[a],s&&(i[a]=this.deserialize(s));return q(i,t.o),i}deserializeProperties(t,r){let i=t.s;if(i){let s=t.k,a=t.v;for(let n=0,o;n<i;n++)o=s[n],typeof o=="string"?r[p(o)]=this.deserialize(a[n]):r[this.deserialize(o)]=this.deserialize(a[n])}return r}deserializeObject(t){let r=this.assignIndexedValue(t.i,t.t===10?{}:Object.create(null));return this.deserializeProperties(t.p,r),q(r,t.o),r}deserializeDate(t){return this.assignIndexedValue(t.i,new Date(t.s))}deserializeRegExp(t){return this.assignIndexedValue(t.i,new RegExp(p(t.c),t.m))}deserializeSet(t){let r=this.assignIndexedValue(t.i,new Set),i=t.a;for(let s=0,a=t.l;s<a;s++)r.add(this.deserialize(i[s]));return r}deserializeMap(t){let r=this.assignIndexedValue(t.i,new Map),i=t.e.k,s=t.e.v;for(let a=0,n=t.e.s;a<n;a++)r.set(this.deserialize(i[a]),this.deserialize(s[a]));return r}deserializeArrayBuffer(t){let r=new Uint8Array(t.s);return this.assignIndexedValue(t.i,r.buffer)}deserializeTypedArray(t){let r=yt(t.c),i=this.deserialize(t.f);return this.assignIndexedValue(t.i,new r(i,t.b,t.l))}deserializeDataView(t){let r=this.deserialize(t.f);return this.assignIndexedValue(t.i,new DataView(r,t.b,t.l))}deserializeDictionary(t,r){if(t.p){let i=this.deserializeProperties(t.p,{});Object.assign(r,i)}return r}deserializeAggregateError(t){let r=this.assignIndexedValue(t.i,new AggregateError([],p(t.m)));return this.deserializeDictionary(t,r)}deserializeError(t){let r=$e[t.s],i=this.assignIndexedValue(t.i,new r(p(t.m)));return this.deserializeDictionary(t,i)}deserializePromise(t){let r=T(),i=this.assignIndexedValue(t.i,r),s=this.deserialize(t.f);return t.s?r.resolve(s):r.reject(s),i.promise}deserializeBoxed(t){return this.assignIndexedValue(t.i,Object(this.deserialize(t.f)))}deserializePlugin(t){let r=this.plugins;if(r){let i=p(t.c);for(let s=0,a=r.length;s<a;s++){let n=r[s];if(n.tag===i)return this.assignIndexedValue(t.i,n.deserialize(t.s,this,{id:t.i}))}}throw new Error('Missing plugin for tag "'+t.c+'".')}deserializePromiseConstructor(t){return this.assignIndexedValue(t.i,T()).promise}deserializePromiseResolve(t){let r=this.refs.get(t.i);d(r,new Error("Missing Promise instance.")),r.resolve(this.deserialize(t.a[1]))}deserializePromiseReject(t){let r=this.refs.get(t.i);d(r,new Error("Missing Promise instance.")),r.reject(this.deserialize(t.a[1]))}deserializeIteratorFactoryInstance(t){this.deserialize(t.a[0]);let r=this.deserialize(t.a[1]);return ct(r)}deserializeAsyncIteratorFactoryInstance(t){this.deserialize(t.a[0]);let r=this.deserialize(t.a[1]);return mt(r)}deserializeStreamConstructor(t){let r=this.assignIndexedValue(t.i,z()),i=t.a.length;if(i)for(let s=0;s<i;s++)this.deserialize(t.a[s]);return r}deserializeStreamNext(t){let r=this.refs.get(t.i);d(r,new Error("Missing Stream instance.")),r.next(this.deserialize(t.f))}deserializeStreamThrow(t){let r=this.refs.get(t.i);d(r,new Error("Missing Stream instance.")),r.throw(this.deserialize(t.f))}deserializeStreamReturn(t){let r=this.refs.get(t.i);d(r,new Error("Missing Stream instance.")),r.return(this.deserialize(t.f))}deserializeIteratorFactory(t){this.deserialize(t.f)}deserializeAsyncIteratorFactory(t){this.deserialize(t.a[1])}deserialize(t){switch(t.t){case 2:return Te[t.s];case 0:return t.s;case 1:return p(t.s);case 3:return BigInt(t.s);case 4:return this.refs.get(t.i);case 18:return this.deserializeReference(t);case 9:return this.deserializeArray(t);case 10:case 11:return this.deserializeObject(t);case 5:return this.deserializeDate(t);case 6:return this.deserializeRegExp(t);case 7:return this.deserializeSet(t);case 8:return this.deserializeMap(t);case 19:return this.deserializeArrayBuffer(t);case 16:case 15:return this.deserializeTypedArray(t);case 20:return this.deserializeDataView(t);case 14:return this.deserializeAggregateError(t);case 13:return this.deserializeError(t);case 12:return this.deserializePromise(t);case 17:return De[t.s];case 21:return this.deserializeBoxed(t);case 25:return this.deserializePlugin(t);case 22:return this.deserializePromiseConstructor(t);case 23:return this.deserializePromiseResolve(t);case 24:return this.deserializePromiseReject(t);case 28:return this.deserializeIteratorFactoryInstance(t);case 30:return this.deserializeAsyncIteratorFactoryInstance(t);case 31:return this.deserializeStreamConstructor(t);case 32:return this.deserializeStreamNext(t);case 33:return this.deserializeStreamThrow(t);case 34:return this.deserializeStreamReturn(t);case 27:return this.deserializeIteratorFactory(t);case 29:return this.deserializeAsyncIteratorFactory(t);default:throw new Error("invariant")}}},zt=class extends bt{constructor(e){super(e),this.mode="vanilla",this.marked=new Set(e.markedRefs)}assignIndexedValue(e,t){return this.marked.has(e)&&this.refs.set(e,t),t}},wt=/^[$A-Z_][0-9A-Z_$]*$/i;function K(e){let t=e[0];return(t==="$"||t==="_"||t>="A"&&t<="Z"||t>="a"&&t<="z")&&wt.test(e)}function m(e){switch(e.t){case 0:return e.s+"="+e.v;case 2:return e.s+".set("+e.k+","+e.v+")";case 1:return e.s+".add("+e.v+")";case 3:return e.s+".delete("+e.k+")"}}function St(e){let t=[],r=e[0];for(let i=1,s=e.length,a,n=r;i<s;i++)a=e[i],a.t===0&&a.v===n.v?r={t:0,s:a.s,k:void 0,v:m(r)}:a.t===2&&a.s===n.s?r={t:2,s:m(r),k:a.k,v:a.v}:a.t===1&&a.s===n.s?r={t:1,s:m(r),k:void 0,v:a.v}:a.t===3&&a.s===n.s?r={t:3,s:m(r),k:a.k,v:void 0}:(t.push(r),r=a),n=a;return t.push(r),t}function H(e){if(e.length){let t="",r=St(e);for(let i=0,s=r.length;i<s;i++)t+=m(r[i])+",";return t}}var Et="Object.create(null)",It="new Set",Rt="new Map",At="Promise.resolve",xt="Promise.reject",Pt={3:"Object.freeze",2:"Object.seal",1:"Object.preventExtensions",0:void 0},kt=class{constructor(e){this.stack=[],this.flags=[],this.assignments=[],this.plugins=e.plugins,this.features=e.features,this.marked=new Set(e.markedRefs)}createFunction(e,t){return this.features&2?(e.length===1?e[0]:"("+e.join(",")+")")+"=>"+t:"function("+e.join(",")+"){return "+t+"}"}createEffectfulFunction(e,t){return this.features&2?(e.length===1?e[0]:"("+e.join(",")+")")+"=>{"+t+"}":"function("+e.join(",")+"){"+t+"}"}markRef(e){this.marked.add(e)}isMarked(e){return this.marked.has(e)}pushObjectFlag(e,t){e!==0&&(this.markRef(t),this.flags.push({type:e,value:this.getRefParam(t)}))}resolveFlags(){let e="";for(let t=0,r=this.flags,i=r.length;t<i;t++){let s=r[t];e+=Pt[s.type]+"("+s.value+"),"}return e}resolvePatches(){let e=H(this.assignments),t=this.resolveFlags();return e?t?e+t:e:t}createAssignment(e,t){this.assignments.push({t:0,s:e,k:void 0,v:t})}createAddAssignment(e,t){this.assignments.push({t:1,s:this.getRefParam(e),k:void 0,v:t})}createSetAssignment(e,t,r){this.assignments.push({t:2,s:this.getRefParam(e),k:t,v:r})}createDeleteAssignment(e,t){this.assignments.push({t:3,s:this.getRefParam(e),k:t,v:void 0})}createArrayAssign(e,t,r){this.createAssignment(this.getRefParam(e)+"["+t+"]",r)}createObjectAssign(e,t,r){this.createAssignment(this.getRefParam(e)+"."+t,r)}isIndexedValueInStack(e){return e.t===4&&this.stack.includes(e.i)}serializeReference(e){return this.assignIndexedValue(e.i,g+'.get("'+e.s+'")')}serializeArrayItem(e,t,r){return t?this.isIndexedValueInStack(t)?(this.markRef(e),this.createArrayAssign(e,r,this.getRefParam(t.i)),""):this.serialize(t):""}serializeArray(e){let t=e.i;if(e.l){this.stack.push(t);let r=e.a,i=this.serializeArrayItem(t,r[0],0),s=i==="";for(let a=1,n=e.l,o;a<n;a++)o=this.serializeArrayItem(t,r[a],a),i+=","+o,s=o==="";return this.stack.pop(),this.pushObjectFlag(e.o,e.i),this.assignIndexedValue(t,"["+i+(s?",]":"]"))}return this.assignIndexedValue(t,"[]")}serializeProperty(e,t,r){if(typeof t=="string"){let i=Number(t),s=i>=0||K(t);if(this.isIndexedValueInStack(r)){let a=this.getRefParam(r.i);return this.markRef(e.i),s&&i!==i?this.createObjectAssign(e.i,t,a):this.createArrayAssign(e.i,s?t:'"'+t+'"',a),""}return(s?t:'"'+t+'"')+":"+this.serialize(r)}return"["+this.serialize(t)+"]:"+this.serialize(r)}serializeProperties(e,t){let r=t.s;if(r){let i=t.k,s=t.v;this.stack.push(e.i);let a=this.serializeProperty(e,i[0],s[0]);for(let n=1,o=a;n<r;n++)o=this.serializeProperty(e,i[n],s[n]),a+=(o&&a&&",")+o;return this.stack.pop(),"{"+a+"}"}return"{}"}serializeObject(e){return this.pushObjectFlag(e.o,e.i),this.assignIndexedValue(e.i,this.serializeProperties(e,e.p))}serializeWithObjectAssign(e,t,r){let i=this.serializeProperties(e,t);return i!=="{}"?"Object.assign("+r+","+i+")":r}serializeStringKeyAssignment(e,t,r,i){let s=this.serialize(i),a=Number(r),n=a>=0||K(r);if(this.isIndexedValueInStack(i))n&&a!==a?this.createObjectAssign(e.i,r,s):this.createArrayAssign(e.i,n?r:'"'+r+'"',s);else{let o=this.assignments;this.assignments=t,n?this.createObjectAssign(e.i,r,s):this.createArrayAssign(e.i,n?r:'"'+r+'"',s),this.assignments=o}}serializeAssignment(e,t,r,i){if(typeof r=="string")this.serializeStringKeyAssignment(e,t,r,i);else{let s=this.stack;this.stack=[];let a=this.serialize(i);this.stack=s;let n=this.assignments;this.assignments=t,this.createArrayAssign(e.i,this.serialize(r),a),this.assignments=n}}serializeAssignments(e,t){let r=t.s;if(r){let i=[],s=t.k,a=t.v;this.stack.push(e.i);for(let n=0;n<r;n++)this.serializeAssignment(e,i,s[n],a[n]);return this.stack.pop(),H(i)}}serializeDictionary(e,t){if(e.p)if(this.features&8)t=this.serializeWithObjectAssign(e,e.p,t);else{this.markRef(e.i);let r=this.serializeAssignments(e,e.p);if(r)return"("+this.assignIndexedValue(e.i,t)+","+r+this.getRefParam(e.i)+")"}return this.assignIndexedValue(e.i,t)}serializeNullConstructor(e){return this.pushObjectFlag(e.o,e.i),this.serializeDictionary(e,Et)}serializeDate(e){return this.assignIndexedValue(e.i,'new Date("'+e.s+'")')}serializeRegExp(e){return this.assignIndexedValue(e.i,"/"+e.c+"/"+e.m)}serializeSetItem(e,t){return this.isIndexedValueInStack(t)?(this.markRef(e),this.createAddAssignment(e,this.getRefParam(t.i)),""):this.serialize(t)}serializeSet(e){let t=It,r=e.l,i=e.i;if(r){let s=e.a;this.stack.push(i);let a=this.serializeSetItem(i,s[0]);for(let n=1,o=a;n<r;n++)o=this.serializeSetItem(i,s[n]),a+=(o&&a&&",")+o;this.stack.pop(),a&&(t+="(["+a+"])")}return this.assignIndexedValue(i,t)}serializeMapEntry(e,t,r,i){if(this.isIndexedValueInStack(t)){let s=this.getRefParam(t.i);if(this.markRef(e),this.isIndexedValueInStack(r)){let n=this.getRefParam(r.i);return this.createSetAssignment(e,s,n),""}if(r.t!==4&&r.i!=null&&this.isMarked(r.i)){let n="("+this.serialize(r)+",["+i+","+i+"])";return this.createSetAssignment(e,s,this.getRefParam(r.i)),this.createDeleteAssignment(e,i),n}let a=this.stack;return this.stack=[],this.createSetAssignment(e,s,this.serialize(r)),this.stack=a,""}if(this.isIndexedValueInStack(r)){let s=this.getRefParam(r.i);if(this.markRef(e),t.t!==4&&t.i!=null&&this.isMarked(t.i)){let n="("+this.serialize(t)+",["+i+","+i+"])";return this.createSetAssignment(e,this.getRefParam(t.i),s),this.createDeleteAssignment(e,i),n}let a=this.stack;return this.stack=[],this.createSetAssignment(e,this.serialize(t),s),this.stack=a,""}return"["+this.serialize(t)+","+this.serialize(r)+"]"}serializeMap(e){let t=Rt,r=e.e.s,i=e.i,s=e.f,a=this.getRefParam(s.i);if(r){let n=e.e.k,o=e.e.v;this.stack.push(i);let l=this.serializeMapEntry(i,n[0],o[0],a);for(let u=1,c=l;u<r;u++)c=this.serializeMapEntry(i,n[u],o[u],a),l+=(c&&l&&",")+c;this.stack.pop(),l&&(t+="(["+l+"])")}return s.t===26&&(this.markRef(s.i),t="("+this.serialize(s)+","+t+")"),this.assignIndexedValue(i,t)}serializeArrayBuffer(e){let t="new Uint8Array(",r=e.s,i=r.length;if(i){t+="["+r[0];for(let s=1;s<i;s++)t+=","+r[s];t+="]"}return this.assignIndexedValue(e.i,t+").buffer")}serializeTypedArray(e){return this.assignIndexedValue(e.i,"new "+e.c+"("+this.serialize(e.f)+","+e.b+","+e.l+")")}serializeDataView(e){return this.assignIndexedValue(e.i,"new DataView("+this.serialize(e.f)+","+e.b+","+e.l+")")}serializeAggregateError(e){let t=e.i;this.stack.push(t);let r=this.serializeDictionary(e,'new AggregateError([],"'+e.m+'")');return this.stack.pop(),r}serializeError(e){return this.serializeDictionary(e,"new "+te[e.s]+'("'+e.m+'")')}serializePromise(e){let t,r=e.f,i=e.i,s=e.s?At:xt;if(this.isIndexedValueInStack(r)){let a=this.getRefParam(r.i);t=s+(e.s?"().then("+this.createFunction([],a)+")":"().catch("+this.createEffectfulFunction([],"throw "+a)+")")}else{this.stack.push(i);let a=this.serialize(r);this.stack.pop(),t=s+"("+a+")"}return this.assignIndexedValue(i,t)}serializeWellKnownSymbol(e){return this.assignIndexedValue(e.i,Ce[e.s])}serializeBoxed(e){return this.assignIndexedValue(e.i,"Object("+this.serialize(e.f)+")")}serializePlugin(e){let t=this.plugins;if(t)for(let r=0,i=t.length;r<i;r++){let s=t[r];if(s.tag===e.c)return this.assignIndexedValue(e.i,s.serialize(e.s,this,{id:e.i}))}throw new Error('Missing plugin for tag "'+e.c+'".')}getConstructor(e){let t=this.serialize(e);return t===this.getRefParam(e.i)?t:"("+t+")"}serializePromiseConstructor(e){return this.assignIndexedValue(e.i,this.getConstructor(e.f)+"()")}serializePromiseResolve(e){return this.getConstructor(e.a[0])+"("+this.getRefParam(e.i)+","+this.serialize(e.a[1])+")"}serializePromiseReject(e){return this.getConstructor(e.a[0])+"("+this.getRefParam(e.i)+","+this.serialize(e.a[1])+")"}serializeSpecialReferenceValue(e){switch(e){case 0:return"[]";case 1:return this.createFunction(["s","f","p"],"((p=new Promise("+this.createEffectfulFunction(["a","b"],"s=a,f=b")+")).s=s,p.f=f,p)");case 2:return this.createEffectfulFunction(["p","d"],'p.s(d),p.status="success",p.value=d;delete p.s;delete p.f');case 3:return this.createEffectfulFunction(["p","d"],'p.f(d),p.status="failure",p.value=d;delete p.s;delete p.f');case 4:return this.createFunction(["b","a","s","l","p","f","e","n"],"(b=[],a=!0,s=!1,l=[],p=0,f="+this.createEffectfulFunction(["v","m","x"],"for(x=0;x<p;x++)l[x]&&l[x][m](v)")+",n="+this.createEffectfulFunction(["o","x","z","c"],'for(x=0,z=b.length;x<z;x++)(c=b[x],x===z-1?o[s?"return":"throw"](c):o.next(c))')+",e="+this.createFunction(["o","t"],"(a&&(l[t=p++]=o),n(o),"+this.createEffectfulFunction([],"a&&(l[t]=void 0)")+")")+",{__SEROVAL_STREAM__:!0,on:"+this.createFunction(["o"],"e(o)")+",next:"+this.createEffectfulFunction(["v"],'a&&(b.push(v),f(v,"next"))')+",throw:"+this.createEffectfulFunction(["v"],'a&&(b.push(v),f(v,"throw"),a=s=!1,l.length=0)')+",return:"+this.createEffectfulFunction(["v"],'a&&(b.push(v),f(v,"return"),a=!1,s=!0,l.length=0)')+"})");default:return""}}serializeSpecialReference(e){return this.assignIndexedValue(e.i,this.serializeSpecialReferenceValue(e.s))}serializeIteratorFactory(e){let t="",r=!1;return e.f.t!==4&&(this.markRef(e.f.i),t="("+this.serialize(e.f)+",",r=!0),t+=this.assignIndexedValue(e.i,this.createFunction(["s"],this.createFunction(["i","c","d","t"],"(i=0,t={["+this.getRefParam(e.f.i)+"]:"+this.createFunction([],"t")+",next:"+this.createEffectfulFunction([],"if(i>s.d)return{done:!0,value:void 0};if(d=s.v[c=i++],c===s.t)throw d;return{done:c===s.d,value:d}")+"})"))),r&&(t+=")"),t}serializeIteratorFactoryInstance(e){return this.getConstructor(e.a[0])+"("+this.serialize(e.a[1])+")"}serializeAsyncIteratorFactory(e){let t=e.a[0],r=e.a[1],i="";t.t!==4&&(this.markRef(t.i),i+="("+this.serialize(t)),r.t!==4&&(this.markRef(r.i),i+=(i?",":"(")+this.serialize(r)),i&&(i+=",");let s=this.assignIndexedValue(e.i,this.createFunction(["s"],this.createFunction(["b","c","p","d","e","t","f"],"(b=[],c=0,p=[],d=-1,e=!1,f="+this.createEffectfulFunction(["i","l"],"for(i=0,l=p.length;i<l;i++)p[i].s({done:!0,value:void 0})")+",s.on({next:"+this.createEffectfulFunction(["v","t"],"if(t=p.shift())t.s({done:!1,value:v});b.push(v)")+",throw:"+this.createEffectfulFunction(["v","t"],"if(t=p.shift())t.f(v);f(),d=b.length,e=!0,b.push(v)")+",return:"+this.createEffectfulFunction(["v","t"],"if(t=p.shift())t.s({done:!0,value:v});f(),d=b.length,b.push(v)")+"}),t={["+this.getRefParam(r.i)+"]:"+this.createFunction([],"t")+",next:"+this.createEffectfulFunction(["i","t","v"],"if(d===-1){return((i=c++)>=b.length)?(p.push(t="+this.getRefParam(t.i)+"()),t):{done:!0,value:b[i]}}if(c>d)return{done:!0,value:void 0};if(v=b[i=c++],i!==d)return{done:!1,value:v};if(e)throw v;return{done:!0,value:v}")+"})")));return i?i+s+")":s}serializeAsyncIteratorFactoryInstance(e){return this.getConstructor(e.a[0])+"("+this.serialize(e.a[1])+")"}serializeStreamConstructor(e){let t=this.assignIndexedValue(e.i,this.getConstructor(e.f)+"()"),r=e.a.length;if(r){let i=this.serialize(e.a[0]);for(let s=1;s<r;s++)i+=","+this.serialize(e.a[s]);return"("+t+","+i+","+this.getRefParam(e.i)+")"}return t}serializeStreamNext(e){return this.getRefParam(e.i)+".next("+this.serialize(e.f)+")"}serializeStreamThrow(e){return this.getRefParam(e.i)+".throw("+this.serialize(e.f)+")"}serializeStreamReturn(e){return this.getRefParam(e.i)+".return("+this.serialize(e.f)+")"}serialize(e){switch(e.t){case 2:return Me[e.s];case 0:return""+e.s;case 1:return'"'+e.s+'"';case 3:return e.s+"n";case 4:return this.getRefParam(e.i);case 18:return this.serializeReference(e);case 9:return this.serializeArray(e);case 10:return this.serializeObject(e);case 11:return this.serializeNullConstructor(e);case 5:return this.serializeDate(e);case 6:return this.serializeRegExp(e);case 7:return this.serializeSet(e);case 8:return this.serializeMap(e);case 19:return this.serializeArrayBuffer(e);case 16:case 15:return this.serializeTypedArray(e);case 20:return this.serializeDataView(e);case 14:return this.serializeAggregateError(e);case 13:return this.serializeError(e);case 12:return this.serializePromise(e);case 17:return this.serializeWellKnownSymbol(e);case 21:return this.serializeBoxed(e);case 22:return this.serializePromiseConstructor(e);case 23:return this.serializePromiseResolve(e);case 24:return this.serializePromiseReject(e);case 25:return this.serializePlugin(e);case 26:return this.serializeSpecialReference(e);case 27:return this.serializeIteratorFactory(e);case 28:return this.serializeIteratorFactoryInstance(e);case 29:return this.serializeAsyncIteratorFactory(e);case 30:return this.serializeAsyncIteratorFactoryInstance(e);case 31:return this.serializeStreamConstructor(e);case 32:return this.serializeStreamNext(e);case 33:return this.serializeStreamThrow(e);case 34:return this.serializeStreamReturn(e);default:throw new Error("invariant")}}},Ft=class extends pt{parseItems(t){let r=[];for(let i=0,s=t.length;i<s;i++)i in t&&(r[i]=this.parse(t[i]));return r}parseArray(t,r){return Ye(t,r,this.parseItems(r))}parseProperties(t){let r=Object.entries(t),i=[],s=[];for(let n=0,o=r.length;n<o;n++)i.push(h(r[n][0])),s.push(this.parse(r[n][1]));let a=Symbol.iterator;return a in t&&(i.push(this.parseWellKnownSymbol(a)),s.push(se(this.parseIteratorFactory(),this.parse(oe(t))))),a=Symbol.asyncIterator,a in t&&(i.push(this.parseWellKnownSymbol(a)),s.push(ae(this.parseAsyncIteratorFactory(),this.parse(z())))),a=Symbol.toStringTag,a in t&&(i.push(this.parseWellKnownSymbol(a)),s.push(M(t[a]))),a=Symbol.isConcatSpreadable,a in t&&(i.push(this.parseWellKnownSymbol(a)),s.push(t[a]?C:D)),{k:i,v:s,s:i.length}}parsePlainObject(t,r,i){return this.createObjectNode(t,r,i,this.parseProperties(r))}parseBoxed(t,r){return et(t,this.parse(r.valueOf()))}parseTypedArray(t,r){return tt(t,r,this.parse(r.buffer))}parseBigIntTypedArray(t,r){return rt(t,r,this.parse(r.buffer))}parseDataView(t,r){return it(t,r,this.parse(r.buffer))}parseError(t,r){let i=N(r,this.features);return st(t,r,i?this.parseProperties(i):void 0)}parseAggregateError(t,r){let i=N(r,this.features);return at(t,r,i?this.parseProperties(i):void 0)}parseMap(t,r){let i=[],s=[];for(let[a,n]of r.entries())i.push(this.parse(a)),s.push(this.parse(n));return this.createMapNode(t,i,s,r.size)}parseSet(t,r){let i=[];for(let s of r.keys())i.push(this.parse(s));return nt(t,r.size,i)}parsePlugin(t,r){let i=this.plugins;if(i)for(let s=0,a=i.length;s<a;s++){let n=i[s];if(n.parse.sync&&n.test(r))return ie(t,n.tag,n.parse.sync(r,this,{id:t}))}}parseStream(t,r){return ne(t,this.parseSpecialReference(4),[])}parsePromise(t,r){return this.createPromiseConstructorNode(t)}parseObject(t,r){if(Array.isArray(r))return this.parseArray(t,r);if(vt(r))return this.parseStream(t,r);let i=this.parsePlugin(t,r);if(i)return i;let s=r.constructor;switch(s){case Object:return this.parsePlainObject(t,r,!1);case void 0:return this.parsePlainObject(t,r,!0);case Date:return Je(t,r);case RegExp:return Ge(t,r);case Error:case EvalError:case RangeError:case ReferenceError:case SyntaxError:case TypeError:case URIError:return this.parseError(t,r);case Number:case Boolean:case String:case BigInt:return this.parseBoxed(t,r);case ArrayBuffer:return Qe(t,r);case Int8Array:case Int16Array:case Int32Array:case Uint8Array:case Uint16Array:case Uint32Array:case Uint8ClampedArray:case Float32Array:case Float64Array:return this.parseTypedArray(t,r);case DataView:return this.parseDataView(t,r);case Map:return this.parseMap(t,r);case Set:return this.parseSet(t,r)}if(s===Promise||r instanceof Promise)return this.parsePromise(t,r);let a=this.features;if(a&16)switch(s){case BigInt64Array:case BigUint64Array:return this.parseBigIntTypedArray(t,r)}if(a&1&&typeof AggregateError<"u"&&(s===AggregateError||r instanceof AggregateError))return this.parseAggregateError(t,r);if(r instanceof Error)return this.parseError(t,r);if(Symbol.iterator in r||Symbol.asyncIterator in r)return this.parsePlainObject(t,r,!!s);throw new W(r)}parse(t){switch(typeof t){case"boolean":return t?C:D;case"undefined":return Ue;case"string":return M(t);case"number":return Ke(t);case"bigint":return He(t);case"object":{if(t){let r=this.getReference(t);return r.type===0?this.parseObject(r.value,t):r.value}return Be}case"symbol":return this.parseWellKnownSymbol(t);case"function":return this.parseFunction(t);default:throw new W(t)}}};function Vt(e,t={}){let r=ee(t.plugins);return new zt({plugins:r,markedRefs:e.m}).deserialize(e.t)}var Ot=class extends kt{constructor(e){super(e),this.mode="cross",this.scopeId=e.scopeId}getRefParam(e){return E+"["+e+"]"}assignIndexedValue(e,t){return this.getRefParam(e)+"="+t}serializeTop(e){let t=this.serialize(e),r=e.i;if(r==null)return t;let i=this.resolvePatches(),s=this.getRefParam(r),a=this.scopeId==null?"":E,n=i?t+","+i+s:t;if(a==="")return i?"("+n+")":n;let o=this.scopeId==null?"()":"("+E+'["'+h(this.scopeId)+'"])';return"("+this.createFunction([a],n)+")"+o}},jt=class extends Ft{constructor(e){super(e),this.alive=!0,this.pending=0,this.initial=!0,this.buffer=[],this.onParseCallback=e.onParse,this.onErrorCallback=e.onError,this.onDoneCallback=e.onDone}onParseInternal(e,t){try{this.onParseCallback(e,t)}catch(r){this.onError(r)}}flush(){for(let e=0,t=this.buffer.length;e<t;e++)this.onParseInternal(this.buffer[e],!1)}onParse(e){this.initial?this.buffer.push(e):this.onParseInternal(e,!1)}onError(e){if(this.onErrorCallback)this.onErrorCallback(e);else throw e}onDone(){this.onDoneCallback&&this.onDoneCallback()}pushPendingState(){this.pending++}popPendingState(){--this.pending<=0&&this.onDone()}parseProperties(e){let t=Object.entries(e),r=[],i=[];for(let a=0,n=t.length;a<n;a++)r.push(h(t[a][0])),i.push(this.parse(t[a][1]));let s=Symbol.iterator;return s in e&&(r.push(this.parseWellKnownSymbol(s)),i.push(se(this.parseIteratorFactory(),this.parse(oe(e))))),s=Symbol.asyncIterator,s in e&&(r.push(this.parseWellKnownSymbol(s)),i.push(ae(this.parseAsyncIteratorFactory(),this.parse(gt(e))))),s=Symbol.toStringTag,s in e&&(r.push(this.parseWellKnownSymbol(s)),i.push(M(e[s]))),s=Symbol.isConcatSpreadable,s in e&&(r.push(this.parseWellKnownSymbol(s)),i.push(e[s]?C:D)),{k:r,v:i,s:r.length}}parsePromise(e,t){return t.then(r=>{let i=this.parseWithError(r);i&&this.onParse({t:23,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:[this.parseSpecialReference(2),i],f:void 0,b:void 0,o:void 0}),this.popPendingState()},r=>{if(this.alive){let i=this.parseWithError(r);i&&this.onParse({t:24,i:e,s:void 0,l:void 0,c:void 0,m:void 0,p:void 0,e:void 0,a:[this.parseSpecialReference(3),i],f:void 0,b:void 0,o:void 0})}this.popPendingState()}),this.pushPendingState(),this.createPromiseConstructorNode(e)}parsePlugin(e,t){let r=this.plugins;if(r)for(let i=0,s=r.length;i<s;i++){let a=r[i];if(a.parse.stream&&a.test(t))return ie(e,a.tag,a.parse.stream(t,this,{id:e}))}}parseStream(e,t){let r=ne(e,this.parseSpecialReference(4),[]);return this.pushPendingState(),t.on({next:i=>{if(this.alive){let s=this.parseWithError(i);s&&this.onParse(ot(e,s))}},throw:i=>{if(this.alive){let s=this.parseWithError(i);s&&this.onParse(lt(e,s))}this.popPendingState()},return:i=>{if(this.alive){let s=this.parseWithError(i);s&&this.onParse(ut(e,s))}this.popPendingState()}}),r}parseWithError(e){try{return this.parse(e)}catch(t){this.onError(t);return}}start(e){let t=this.parseWithError(e);t&&(this.onParseInternal(t,!0),this.initial=!1,this.flush(),this.pending<=0&&this.destroy())}destroy(){this.alive&&(this.onDone(),this.alive=!1)}isAlive(){return this.alive}},Ct=class extends jt{constructor(){super(...arguments),this.mode="cross"}};function Dt(e,t){let r=ee(t.plugins),i=new Ct({plugins:r,refs:t.refs,disabledFeatures:t.disabledFeatures,onParse(s,a){let n=new Ot({plugins:r,features:i.features,scopeId:t.scopeId,markedRefs:i.marked}),o;try{o=n.serializeTop(s)}catch(l){t.onError&&t.onError(l);return}t.onSerialize(o,a)},onError:t.onError,onDone:t.onDone});return i.start(e),()=>{i.destroy()}}function x(e){return{detail:e.detail,bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}}var Mt={tag:"seroval-plugins/web/CustomEvent",test(e){return typeof CustomEvent>"u"?!1:e instanceof CustomEvent},parse:{sync(e,t){return{type:t.parse(e.type),options:t.parse(x(e))}},async async(e,t){return{type:await t.parse(e.type),options:await t.parse(x(e))}},stream(e,t){return{type:t.parse(e.type),options:t.parse(x(e))}}},serialize(e,t){return"new CustomEvent("+t.serialize(e.type)+","+t.serialize(e.options)+")"},deserialize(e,t){return new CustomEvent(t.deserialize(e.type),t.deserialize(e.options))}},le=Mt,Tt={tag:"seroval-plugins/web/DOMException",test(e){return typeof DOMException>"u"?!1:e instanceof DOMException},parse:{sync(e,t){return{name:t.parse(e.name),message:t.parse(e.message)}},async async(e,t){return{name:await t.parse(e.name),message:await t.parse(e.message)}},stream(e,t){return{name:t.parse(e.name),message:t.parse(e.message)}}},serialize(e,t){return"new DOMException("+t.serialize(e.message)+","+t.serialize(e.name)+")"},deserialize(e,t){return new DOMException(t.deserialize(e.message),t.deserialize(e.name))}},ue=Tt;function P(e){return{bubbles:e.bubbles,cancelable:e.cancelable,composed:e.composed}}var $t={tag:"seroval-plugins/web/Event",test(e){return typeof Event>"u"?!1:e instanceof Event},parse:{sync(e,t){return{type:t.parse(e.type),options:t.parse(P(e))}},async async(e,t){return{type:await t.parse(e.type),options:await t.parse(P(e))}},stream(e,t){return{type:t.parse(e.type),options:t.parse(P(e))}}},serialize(e,t){return"new Event("+t.serialize(e.type)+","+t.serialize(e.options)+")"},deserialize(e,t){return new Event(t.deserialize(e.type),t.deserialize(e.options))}},ce=$t,Ut={tag:"seroval-plugins/web/File",test(e){return typeof File>"u"?!1:e instanceof File},parse:{async async(e,t){return{name:await t.parse(e.name),options:await t.parse({type:e.type,lastModified:e.lastModified}),buffer:await t.parse(await e.arrayBuffer())}}},serialize(e,t){return"new File(["+t.serialize(e.buffer)+"],"+t.serialize(e.name)+","+t.serialize(e.options)+")"},deserialize(e,t){return new File([t.deserialize(e.buffer)],t.deserialize(e.name),t.deserialize(e.options))}},Bt=Ut;function k(e){let t=[];return e.forEach((r,i)=>{t.push([i,r])}),t}var y={},_t={tag:"seroval-plugins/web/FormDataFactory",test(e){return e===y},parse:{sync(){},async async(){return await Promise.resolve(void 0)},stream(){}},serialize(e,t){return t.createEffectfulFunction(["e","f","i","s","t"],"f=new FormData;for(i=0,s=e.length;i<s;i++)f.append((t=e[i])[0],t[1]);return f")},deserialize(){return y}},Wt={tag:"seroval-plugins/web/FormData",extends:[Bt,_t],test(e){return typeof FormData>"u"?!1:e instanceof FormData},parse:{sync(e,t){return{factory:t.parse(y),entries:t.parse(k(e))}},async async(e,t){return{factory:await t.parse(y),entries:await t.parse(k(e))}},stream(e,t){return{factory:t.parse(y),entries:t.parse(k(e))}}},serialize(e,t){return"("+t.serialize(e.factory)+")("+t.serialize(e.entries)+")"},deserialize(e,t){let r=new FormData,i=t.deserialize(e.entries);for(let s=0,a=i.length;s<a;s++){let n=i[s];r.append(n[0],n[1])}return r}},de=Wt;function F(e){let t=[];return e.forEach((r,i)=>{t.push([i,r])}),t}var Nt={tag:"seroval-plugins/web/Headers",test(e){return typeof Headers>"u"?!1:e instanceof Headers},parse:{sync(e,t){return t.parse(F(e))},async async(e,t){return await t.parse(F(e))},stream(e,t){return t.parse(F(e))}},serialize(e,t){return"new Headers("+t.serialize(e)+")"},deserialize(e,t){return new Headers(t.deserialize(e))}},R=Nt,b={},Lt={tag:"seroval-plugins/web/ReadableStreamFactory",test(e){return e===b},parse:{sync(){},async async(){return await Promise.resolve(void 0)},stream(){}},serialize(e,t){return t.createFunction(["d"],"new ReadableStream({start:"+t.createEffectfulFunction(["c"],"d.on({next:"+t.createEffectfulFunction(["v"],"c.enqueue(v)")+",throw:"+t.createEffectfulFunction(["v"],"c.error(v)")+",return:"+t.createEffectfulFunction([],"c.close()")+"})")+"})")},deserialize(){return b}};function Z(e){let t=z(),r=e.getReader();async function i(){try{let s=await r.read();s.done?t.return(s.value):(t.next(s.value),await i())}catch(s){t.throw(s)}}return i().catch(()=>{}),t}var qt={tag:"seroval/plugins/web/ReadableStream",extends:[Lt],test(e){return typeof ReadableStream>"u"?!1:e instanceof ReadableStream},parse:{sync(e,t){return{factory:t.parse(b),stream:t.parse(z())}},async async(e,t){return{factory:await t.parse(b),stream:await t.parse(Z(e))}},stream(e,t){return{factory:t.parse(b),stream:t.parse(Z(e))}}},serialize(e,t){return"("+t.serialize(e.factory)+")("+t.serialize(e.stream)+")"},deserialize(e,t){let r=t.deserialize(e.stream);return new ReadableStream({start(i){r.on({next(s){i.enqueue(s)},throw(s){i.error(s)},return(){i.close()}})}})}},A=qt;function J(e,t){return{body:t,cache:e.cache,credentials:e.credentials,headers:e.headers,integrity:e.integrity,keepalive:e.keepalive,method:e.method,mode:e.mode,redirect:e.redirect,referrer:e.referrer,referrerPolicy:e.referrerPolicy}}var Kt={tag:"seroval-plugins/web/Request",extends:[A,R],test(e){return typeof Request>"u"?!1:e instanceof Request},parse:{async async(e,t){return{url:await t.parse(e.url),options:await t.parse(J(e,e.body?await e.clone().arrayBuffer():null))}},stream(e,t){return{url:t.parse(e.url),options:t.parse(J(e,e.clone().body))}}},serialize(e,t){return"new Request("+t.serialize(e.url)+","+t.serialize(e.options)+")"},deserialize(e,t){return new Request(t.deserialize(e.url),t.deserialize(e.options))}},he=Kt;function G(e){return{headers:e.headers,status:e.status,statusText:e.statusText}}var Ht={tag:"seroval-plugins/web/Response",extends:[A,R],test(e){return typeof Response>"u"?!1:e instanceof Response},parse:{async async(e,t){return{body:await t.parse(e.body?await e.clone().arrayBuffer():null),options:await t.parse(G(e))}},stream(e,t){return{body:t.parse(e.clone().body),options:t.parse(G(e))}}},serialize(e,t){return"new Response("+t.serialize(e.body)+","+t.serialize(e.options)+")"},deserialize(e,t){return new Response(t.deserialize(e.body),t.deserialize(e.options))}},fe=Ht,Zt={tag:"seroval-plugins/web/URLSearchParams",test(e){return typeof URLSearchParams>"u"?!1:e instanceof URLSearchParams},parse:{sync(e,t){return t.parse(e.toString())},async async(e,t){return await t.parse(e.toString())},stream(e,t){return t.parse(e.toString())}},serialize(e,t){return"new URLSearchParams("+t.serialize(e)+")"},deserialize(e,t){return new URLSearchParams(t.deserialize(e))}},pe=Zt,Jt={tag:"seroval-plugins/web/URL",test(e){return typeof URL>"u"?!1:e instanceof URL},parse:{sync(e,t){return t.parse(e.href)},async async(e,t){return await t.parse(e.href)},stream(e,t){return t.parse(e.href)}},serialize(e,t){return"new URL("+t.serialize(e)+")"},deserialize(e,t){return new URL(t.deserialize(e))}},ve=Jt;const V="Invariant Violation",{setPrototypeOf:Gt=function(e,t){return e.__proto__=t,e}}=Object;class U extends Error{framesToPop=1;name=V;constructor(t=V){super(typeof t=="number"?`${V}: ${t} (see https://github.com/apollographql/invariant-packages)`:t),Gt(this,U.prototype)}}function Q(e,t){if(!e)throw new U(t)}const ge=Symbol("h3Event"),I=Symbol("fetchEvent"),Qt={get(e,t){return t===I?e:e[t]??e[ge][t]}};function Xt(e){return new Proxy({request:ze(e),clientAddress:we(e),locals:{},[ge]:e},Qt)}function Yt(e){if(!e[I]){const t=Xt(e);e[I]=t}return e[I]}function er(e,t){return new ReadableStream({start(r){Dt(t,{scopeId:e,plugins:[le,ue,ce,de,R,A,he,fe,pe,ve],onSerialize(i,s){const a=s?`(${ke(e)},${i})`:i;r.enqueue(new TextEncoder().encode(`${a};
`))},onDone(){r.close()},onError(i){r.error(i)}})}})}async function tr(e){Q(e.method==="POST",`Invalid method ${e.method}. Expected POST.`);const t=w(e,"x-server-id"),r=w(e,"x-server-instance"),i=_(e);let s,a;if(t)Q(typeof t=="string","Invalid server function"),[s,a]=t.split("#");else if(s=i.searchParams.get("id"),a=i.searchParams.get("name"),!s||!a)throw new Error("Invalid request");const n=(await globalThis.MANIFEST["server-fns"].chunks[s].import())[a];let o=[];if(!r){const u=i.searchParams.get("args");u&&JSON.parse(u).forEach(c=>o.push(c))}const l=w(e,"content-type");if(l.startsWith("multipart/form-data")||l.startsWith("application/x-www-form-urlencoded")){const u=new Request(_(e),{method:e.method,headers:e.headers,body:await Ee(e)});o.push(await u.formData())}else o=Vt(await Ie(e),{plugins:[le,ue,ce,de,R,A,he,fe,pe,ve]});try{const u=Yt(e),c=await be(u,()=>(ye.context={event:u},n(...o)));if(!r){const B=c instanceof Error,me=new URL(w(e,"referer"));return new Response(null,{status:302,headers:{Location:me.toString(),...c?{"Set-Cookie":`flash=${JSON.stringify({url:i.pathname+encodeURIComponent(i.search),result:B?c.message:c,error:B,input:[...o.slice(0,-1),[...o[o.length-1].entries()]]})}; Secure; HttpOnly;`}:{}}})}return typeof c=="string"?new Response(c):(Re(e,"content-type","text/javascript"),er(r,c))}catch(u){return u instanceof Response&&u.status===302?new Response(null,{status:r?204:302,headers:{Location:u.headers.get("Location")}}):u}}const ur=Se(tr);export{ur as default};
